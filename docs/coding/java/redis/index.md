---
outline: deep
---

# Redis@7å¿«é€Ÿå…¥é—¨

## ä¸€ã€ç¯å¢ƒå‡†å¤‡

+ VMware å·²å®‰è£… Ubantu æ“ä½œç³»ç»Ÿ
+ MobaXterm SSH è¿æ¥å·¥å…·

## äºŒã€Rediså®‰è£…æ•™ç¨‹

### 1.1ã€Rediså®‰è£…

å®˜æ–¹å®‰è£…åœ°å€ï¼šhttps://redis.io/docs/latest/get-started/ï¼Œé€‰æ‹© [Install Redis on Linux](https://redis.io/docs/latest/operate/oss_and_stack/install/install-redis/install-redis-on-linux/)

å‚ç…§ Install on Ubuntu/Debian å‘½ä»¤è¿›è¡Œå®‰è£…

```bash
sudo apt-get install lsb-release curl gpg
curl -fsSL https://packages.redis.io/gpg | sudo gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg
sudo chmod 644 /usr/share/keyrings/redis-archive-keyring.gpg
echo "deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/redis.list
sudo apt-get update
sudo apt-get install redis
```

ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ Redis

```bash
sudo systemctl enable redis-server
sudo systemctl start redis-server
sudo systemctl stop redis-server # åœæ­¢è¿è¡Œ
```

Once Redis is running, you can test it by running `redis-cli`:

```bash
redis-cli
```

æ£€æŸ¥ Redis æ˜¯å¦è¿è¡Œï¼š

![image-20241228124606128](images/image-20241228124606128.png)

ç”±æ­¤ Redis å®‰è£…æˆåŠŸï¼Œä¹Ÿå¯ä»¥é€šè¿‡ linux å‘½ä»¤æŸ¥çœ‹ Redis è¿›ç¨‹æœåŠ¡

```bash
ps aux | grep redis
```

### 1.2ã€Redis å¸¸è§„å‘½ä»¤çš„ä½¿ç”¨

å¦‚ä½•é€€å‡º Redis å‘½ä»¤å®¢æˆ·ç«¯

```bash
exit # é€€å‡º redis  
redis-cli # è¿›å…¥ redis å‘½ä»¤å®¢æˆ·ç«¯
```

å¦‚ä½•åœæ­¢ Redis è¿è¡Œ

```bash
redis-cli shutdown # ä¸€èˆ¬ä½¿ç”¨
systemctl stop redis # Redisæ˜¯é€šè¿‡ç³»ç»ŸæœåŠ¡ç®¡ç†å™¨è¿è¡Œï¼Œä¾‹å¦‚ sudo systemctl start redis-server
```

å†æ¬¡é€šè¿‡ redis-cli ping å‘½ä»¤æ£€æŸ¥ Redis æ˜¯å¦å†è¿è¡Œ

## ä¸‰ã€Redis å®¢æˆ·ç«¯

### 3.1ã€å‘½ä»¤è¡Œå®¢æˆ·ç«¯

æ‰“å¼€å‘½ä»¤è¡Œå®¢æˆ·ç«¯çš„å‘½ä»¤

```bash
redis-cli -p ç«¯å£ # è¿›å…¥å‘½ä»¤è¡Œå®¢æˆ·ç«¯
```

### 3.2ã€å¯è§†åŒ–å®¢æˆ·ç«¯

Redis å¯è§†åŒ–å®¢æˆ·ç«¯ç›®å‰æœ‰ RedisInsightã€RedisPlusç­‰ï¼Œç›¸å…³é…ç½®ä¸‹è½½å¯ä»¥å‚è€ƒå…¶ä»–é€”å¾„è·å–ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯è§†åŒ–å®¢æˆ·ç«¯è¿æ¥å¡«å…¥å¯¹åº”çš„ Redis çš„ ip å³å¯æˆåŠŸè¿æ¥

### 3.3ã€API å®¢æˆ·ç«¯

APIå®¢æˆ·ç«¯æŒ‡åœ¨ç¼–ç¨‹ä»£ç ä¸­è°ƒç”¨ Redis çš„ apiã€ä¾‹å¦‚åœ¨ Javaã€Node.jsã€Python ä¸­ã€‚

è¯¦æƒ…åœ¨ https://redis.io/docs/latest/integrate/ æŸ¥æ‰¾ç›¸å…³ä¿¡æ¯

## å››ã€Redis é…ç½®æ–‡ä»¶

æŒ‰ç…§ Redis å®˜ç½‘ä¸‹è½½ Redis@7 ç‰ˆæœ¬ï¼Œé…ç½®æ–‡ä»¶åœ¨ /etc/redis ç›®å½•ä¸‹ï¼Œå…·ä½“é…ç½®è¯¦è§£å¦‚ä¸‹ï¼š

```bash
#å¼•ç”¨å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œå¤šå®ä¾‹çš„æƒ…å†µå¯ä»¥æŠŠå…¬ç”¨é…ç½®æ–‡ä»¶æå–å‡ºæ¥
include /path/to/other.conf

# æŒ‡å®šredisåªèƒ½æ¥å—æ¥è‡ªæ­¤IPç»‘å®šçš„ç½‘å¡çš„è¯·æ±‚ï¼Œæ³¨æ„æ­¤é»˜è®¤å€¼é»˜è®¤å¤–ç½‘æ˜¯ä¸å¯è®¿é—®çš„
# ç”Ÿäº§ç¯å¢ƒè‚¯å®šè¦å†™ä½ åº”ç”¨æœåŠ¡å™¨çš„åœ°å€ï¼›æœåŠ¡å™¨æ˜¯éœ€è¦è¿œç¨‹è®¿é—®çš„ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶æ³¨é‡Šæ‰
bind 127.0.0.1  # æœ¬åœ°
bind 0.0.0.0    # æ”¯å‡ºå¤–ç½‘

# é»˜è®¤ç«¯å£ï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä¸è¦ä½¿ç”¨é»˜è®¤ç«¯å£é¿å…è¢«æ¶æ„æ‰«æåˆ°
port 6379

# æ˜¯å¦å¼€å¯ä¿æŠ¤æ¨¡å¼ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šbindå’Œå¯†ç ï¼Œredisåªä¼šæœ¬åœ°è¿›è¡Œè®¿é—®ï¼Œæ‹’ç»å¤–éƒ¨è®¿é—®ã€‚
# å°†æœ¬æœºè®¿é—®ä¿æŠ¤æ¨¡å¼è®¾ç½® no
protected-mode yes

# tcp keepaliveå‚æ•°  
# å¯¹è®¿é—®å®¢æˆ·ç«¯çš„ä¸€ç§å¿ƒè·³æ£€æµ‹ï¼Œæ¯ä¸ª n ç§’æ£€æµ‹ä¸€æ¬¡
# å•ä½ä¸ºç§’ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™ä¸ä¼šè¿›è¡Œkeepaliveæ£€æµ‹ï¼Œå»ºè®®è®¾ç½®æˆ60
tcp-keepalive 300

# é…ç½®unix socketæ¥è®©redisæ”¯æŒç›‘å¬æœ¬åœ°è¿æ¥ã€‚
#unixsocket /tmp/redis.sock

# é…ç½®unix socketä½¿ç”¨æ–‡ä»¶çš„æƒé™
#unixsocketperm 700

#å®¢æˆ·ç«¯è¿æ¥ç©ºé—²è¶…è¿‡timeoutå°†ä¼šè¢«æ–­å¼€ï¼Œä¸º0åˆ™å…³é—­è¯¥åŠŸèƒ½ï¼ˆ0è¡¨ç¤ºä¸æ–­ï¼Œä¸€ç›´è¿ç€ï¼‰
timeout 0


# å®ˆæŠ¤è¿›ç¨‹ï¼Œåå°å¯åŠ¨ ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œé»˜è®¤æ˜¯ noï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å¼€å¯ä¸ºyesï¼
daemonize yes


# pidfile å­˜æ”¾ pid æ–‡ä»¶çš„ä½ç½®ï¼Œæ¯ä¸ªå®ä¾‹ä¼šäº§ç”Ÿä¸€ä¸ªä¸åŒçš„ pid æ–‡ä»¶
pidfile /var/run/redis_6379.pid

# å¯ä»¥é€šè¿‡upstartå’Œsystemdç®¡ç†Rediså®ˆæŠ¤è¿›ç¨‹
# é€‰é¡¹ï¼š
# supervised no - æ²¡æœ‰ç›‘ç£äº’åŠ¨
# supervised upstart - é€šè¿‡å°†Redisç½®äºSIGSTOPæ¨¡å¼æ¥å¯åŠ¨ä¿¡å·
# supervised systemd - signal systemdå°†READY = 1å†™å…¥$ NOTIFY_SOCKET
# supervised auto - æ£€æµ‹upstartæˆ–systemdæ–¹æ³•åŸºäº UPSTART_JOBæˆ–NOTIFY_SOCKETç¯å¢ƒå˜é‡
supervised no

# æ—¥å¿—
# æ³¨æ„ï¼šæ—¥å¿—çº§åˆ«å¼€å‘æœŸè®¾ç½®ä¸ºverboseå³å¯ï¼Œç”Ÿäº§ç¯å¢ƒä¸­é…ç½®ä¸ºnoticeï¼Œç®€åŒ–æ—¥å¿—è¾“å‡ºé‡ï¼Œé™ä½å†™æ—¥å¿—IOçš„é¢‘åº¦
#	debug
#	verbose
#	notice
#	warning
# æ—¥å¿—çº§åˆ«  ç”Ÿäº§ç¯å¢ƒ
loglevel notice

# æ—¥å¿—çš„æ–‡ä»¶ä½ç½®å  ä¸€èˆ¬ä»¥ç«¯å£å·.logå‘½å  6379.log
logfile ""

# æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤æ˜¯ 16 ä¸ªæ•°æ®åº“  é»˜è®¤æ•°æ®åº“ä¸º 0
databases 16

# æ˜¯å¦æ€»æ˜¯æ˜¾ç¤ºLOGO 
always-show-logo yes

# è®¾ç½®å¯†ç  è®¿é—®å¯†ç çš„æŸ¥çœ‹ã€è®¾ç½®å’Œå–æ¶ˆ
# åœ¨å‘½ä»¤ä¸­è®¾ç½®å¯†ç ï¼Œåªæ˜¯ä¸´æ—¶çš„ã€‚é‡å¯ redis æœåŠ¡å™¨ï¼Œå¯†ç å°±è¿˜åŸäº†
# æ°¸ä¹…è®¾ç½®ï¼Œéœ€è¦å†é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ã€‚
requirepass å¯†ç 

# è®¾ç½® redis åŒæ—¶å¯ä»¥ä¸å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥  é»˜è®¤æƒ…å†µä¸‹ä¸º 10000 ä¸ªå®¢æˆ·ç«¯
# å¦‚æœè¾¾åˆ°äº†æ­¤é™åˆ¶ï¼Œredis åˆ™ä¼šæ‹’ç»æ–°çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶ä¸”å‘è¿™äº›è¿æ¥è¯·æ±‚æ–¹å‘å‡ºâ€œmax number of clients reachedâ€ä»¥ä½œå›åº”
maxclients 100

# é…ç½®æœ€å¤§çš„å†…å­˜å®¹é‡
# å»ºè®®å¿…é¡»è®¾ç½®ï¼Œå¦åˆ™ï¼Œå°†å†…å­˜å æ»¡ï¼Œé€ æˆæœåŠ¡å™¨å®•æœº
# è®¾ç½® redis å¯ä»¥ä½¿ç”¨çš„å†…å­˜é‡ã€‚ä¸€æ—¦åˆ°è¾¾å†…å­˜ä½¿ç”¨ä¸Šé™ï¼Œredis å°†ä¼šè¯•å›¾ç§»é™¤å†…éƒ¨æ•°æ®ï¼Œç§»é™¤è§„åˆ™å¯ä»¥é€šè¿‡ maxmemory-policy æ¥æŒ‡å®š
# å¦‚æœ redis æ— æ³•æ ¹æ®ç§»é™¤è§„åˆ™æ¥ç§»é™¤å†…å­˜ä¸­çš„æ•°æ®ï¼Œæˆ–è€…è®¾ç½®äº†â€œä¸å…è®¸ç§»é™¤â€ï¼Œé‚£ä¹ˆ redis åˆ™ä¼šé’ˆå¯¹é‚£äº›éœ€è¦ç”³è¯·å†…å­˜çš„æŒ‡ä»¤è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚ SETã€LPUSH ç­‰
# ä½†æ˜¯å¯¹äºæ— å†…å­˜ç”³è¯·çš„æŒ‡ä»¤ï¼Œä»ç„¶ä¼šæ­£å¸¸å“åº”ï¼Œæ¯”å¦‚ GET ç­‰ã€‚å¦‚æœä½ çš„ redis æ˜¯ä¸»redisï¼ˆè¯´æ˜ä½ çš„ redis æœ‰ä» redisï¼‰ï¼Œé‚£ä¹ˆåœ¨è®¾ç½®å†…å­˜ä½¿ç”¨ä¸Šé™æ—¶ï¼Œéœ€è¦åœ¨ç³»ç»Ÿä¸­ç•™å‡ºä¸€äº›å†…å­˜ç©ºé—´ç»™åŒæ­¥é˜Ÿåˆ—ç¼“å­˜ï¼Œåªæœ‰åœ¨ä½ è®¾ç½®çš„æ˜¯â€œä¸ç§»é™¤â€çš„æƒ…å†µä¸‹ï¼Œæ‰ä¸ç”¨è€ƒè™‘è¿™ä¸ªå› ç´ 
maxmemory 128

# å†…å­˜åˆ°è¾¾ä¸Šé™ä¹‹åçš„å¤„ç†ç­–ç•¥
# volatile-lruï¼šä½¿ç”¨ LRU ç®—æ³•ç§»é™¤ keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ï¼›ï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰
# 1ã€volatile-lruï¼šåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyè¿›è¡Œ LRUï¼ˆé»˜è®¤å€¼ï¼‰
# 2ã€allkeys-lru ï¼š åœ¨æ‰€æœ‰é›†åˆ key ä¸­ï¼Œä½¿ç”¨ LRU ç®—æ³•ç§»é™¤ key
# 3ã€volatile-randomï¼šéšæœºåˆ é™¤å³å°†è¿‡æœŸkey  åœ¨è¿‡æœŸé›†åˆä¸­ç§»é™¤éšæœºçš„ keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®
# 4ã€allkeys-randomï¼šåœ¨æ‰€æœ‰é›†åˆ key ä¸­ï¼Œç§»é™¤éšæœºçš„ key
# 5ã€volatile-ttl ï¼š åˆ é™¤å³å°†è¿‡æœŸçš„ ç§»é™¤é‚£äº› TTL å€¼æœ€å°çš„ keyï¼Œå³é‚£äº›æœ€è¿‘è¦è¿‡æœŸçš„ key
# 6ã€noeviction ï¼š æ°¸ä¸è¿‡æœŸï¼Œè¿”å›é”™è¯¯  ä¸è¿›è¡Œç§»é™¤ã€‚é’ˆå¯¹å†™æ“ä½œï¼Œåªæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯
maxmemory-policy noeviction 

# è®¾ç½®æ ·æœ¬æ•°é‡ï¼ŒLRU ç®—æ³•å’Œæœ€å° TTL ç®—æ³•éƒ½å¹¶éæ˜¯ç²¾ç¡®çš„ç®—æ³•ï¼Œè€Œæ˜¯ä¼°ç®—å€¼ï¼Œæ‰€ä»¥ä½ å¯ä»¥è®¾ç½®æ ·æœ¬çš„å¤§å°ï¼Œredis é»˜è®¤ä¼šæ£€æŸ¥è¿™ä¹ˆå¤šä¸ª key å¹¶é€‰æ‹©å…¶ä¸­ LRU çš„é‚£ä¸ª
# ä¸€èˆ¬è®¾ç½® 3 åˆ° 7 çš„æ•°å­—ï¼Œæ•°å€¼è¶Šå°æ ·æœ¬è¶Šä¸å‡†ç¡®ï¼Œä½†æ€§èƒ½æ¶ˆè€—è¶Šå°
maxmemory-samples 5

# è®¾ç½®ä¿å­˜å¿«ç…§çš„è§„åˆ™: 300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰å†…è‡³å°‘10ä¸ªkeyå€¼æ”¹å˜ï¼ˆåˆ™è¿›è¡Œæ•°æ®åº“ä¿å­˜--æŒä¹…åŒ–ï¼‰
save 300 10

# æŒä¹…åŒ–å¦‚æœå‡ºé”™ï¼Œæ˜¯å¦è¿˜éœ€è¦ç»§ç»­å·¥ä½œï¼ yesï¼šä¸èƒ½è¿›è¡Œå·¥ä½œï¼Œnoï¼šå¯ä»¥ç»§ç»­è¿›è¡Œå·¥ä½œ
# å¯ä»¥é€šè¿‡infoä¸­çš„rdb_last_bgsave_statusäº†è§£RDBæŒä¹…åŒ–æ˜¯å¦æœ‰é”™è¯¯
stop-writes-on-bgsave-error yes

# æ˜¯å¦å‹ç¼© rdb æ–‡ä»¶ï¼Œrdbæ–‡ä»¶å‹ç¼©ä½¿ç”¨LZFå‹ç¼©ç®—æ³•
# yesï¼šå‹ç¼©ï¼Œä½†æ˜¯éœ€è¦ä¸€äº›cpuçš„æ¶ˆè€—ã€‚noï¼šä¸å‹ç¼©ï¼Œéœ€è¦æ›´å¤šçš„ç£ç›˜ç©ºé—´
rdbcompression yes

# ä¿å­˜rdbæ–‡ä»¶çš„æ—¶å€™ï¼Œè¿›è¡Œé”™è¯¯çš„æ£€æŸ¥æ ¡éªŒï¼
rdbchecksum yes 

# å‘½åæŒä¹…åŒ–æ–‡ä»¶åç§°
dbfilename dump.rdb

# rdb æ–‡ä»¶ä¿å­˜çš„ç›®å½•ï¼ æ•°æ®åº“çš„å†™å…¥ä¼šåœ¨è¿™ä¸ªç›®å½•ã€‚rdbã€aofæ–‡ä»¶ä¹Ÿä¼šå†™åœ¨è¿™ä¸ªç›®å½•
dir ./

# ä¸»ä»å¤åˆ¶æŒ‡å®šä¸»èŠ‚ç‚¹masterè®¾ç½® ä¸»æœºçš„ipåŠç«¯å£
replicaof <masterip> <masterport>
replicaof 192.168.1.20 6379
 
# masterçš„å¯†ç è®¾ç½® æ˜¯å¦éœ€è¦å¯†ç 
masterauth <master-password>
 
# å½“ä¸€ä¸ªslaveå¤±å»å’Œmasterçš„è¿æ¥ï¼Œæˆ–è€…åŒæ­¥æ­£åœ¨è¿›è¡Œä¸­ï¼Œslaveçš„è¡Œä¸ºæœ‰ä¸¤ç§å¯èƒ½ï¼š
# å¦‚æœ replica-serve-stale-data è®¾ç½®ä¸º â€œyesâ€ (é»˜è®¤å€¼)ï¼Œslaveä¼šç»§ç»­å“åº”å®¢æˆ·ç«¯# è¯·æ±‚ï¼Œå¯èƒ½æ˜¯æ­£å¸¸æ•°æ®ï¼Œä¹Ÿå¯èƒ½æ˜¯è¿˜æ²¡è·å¾—å€¼çš„ç©ºæ•°æ®ã€‚
# å¦‚æœ replica-serve-stale-data è®¾ç½®ä¸º â€œnoâ€ï¼Œslaveä¼šå›å¤"æ­£åœ¨ä»masteråŒæ­¥
# ï¼ˆSYNC with master in progressï¼‰"æ¥å¤„ç†å„ç§è¯·æ±‚ï¼Œé™¤äº† INFO å’Œ SLAVEOF å‘½ä»¤ã€‚
replica-serve-stale-data yes
 
# é…ç½®ä»æ˜¯å¦ä¸ºåªè¯»ï¼Œå¼€å¯åä»åˆ™ä¸èƒ½å†™å…¥æ•°æ®
replica-read-only yes
 
# åŒæ­¥ç­–ç•¥: ç£ç›˜æˆ–socketï¼Œé»˜è®¤ç£ç›˜æ–¹å¼
repl-diskless-sync no
 
# å¦‚æœéç£ç›˜åŒæ­¥æ–¹å¼å¼€å¯ï¼Œå¯ä»¥é…ç½®åŒæ­¥å»¶è¿Ÿæ—¶é—´ï¼Œä»¥ç­‰å¾…masteräº§ç”Ÿå­è¿›ç¨‹é€šè¿‡socketä¼ è¾“RDBæ•°æ®ç»™slaveã€‚
# é»˜è®¤å€¼ä¸º5ç§’ï¼Œè®¾ç½®ä¸º0ç§’åˆ™æ¯æ¬¡ä¼ è¾“æ— å»¶è¿Ÿã€‚
repl-diskless-sync-delay 5
 
# slaveæ ¹æ®æŒ‡å®šçš„æ—¶é—´é—´éš”å‘masterå‘é€pingè¯·æ±‚ã€‚é»˜è®¤10ç§’ã€‚
repl-ping-replica-period 10
 
# åŒæ­¥çš„è¶…æ—¶æ—¶é—´
# slaveåœ¨ä¸master SYNCæœŸé—´æœ‰å¤§é‡æ•°æ®ä¼ è¾“ï¼Œé€ æˆè¶…æ—¶
# åœ¨slaveè§’åº¦ï¼Œmasterè¶…æ—¶ï¼ŒåŒ…æ‹¬æ•°æ®ã€pingç­‰
# åœ¨masterè§’åº¦ï¼Œslaveè¶…æ—¶ï¼Œå½“masterå‘é€REPLCONF ACK pings
# ç¡®ä¿è¿™ä¸ªå€¼å¤§äºæŒ‡å®šçš„repl-ping-slave-periodï¼Œå¦åˆ™åœ¨ä¸»ä»é—´æµé‡ä¸é«˜æ—¶æ¯æ¬¡éƒ½ä¼šæ£€æµ‹åˆ°è¶…æ—¶
repl-timeout 60
 
# æ˜¯å¦åœ¨slaveå¥—æ¥å­—å‘é€SYNCä¹‹åç¦ç”¨ TCP_NODELAY
# å¦‚æœé€‰æ‹©yesï¼ŒRediså°†ä½¿ç”¨æ›´å°‘çš„TCPåŒ…å’Œå¸¦å®½æ¥å‘slaveså‘é€æ•°æ®ã€‚ä½†æ˜¯è¿™å°†ä½¿æ•°æ®ä¼ è¾“åˆ°slaveä¸Šæœ‰å»¶è¿Ÿï¼ŒLinuxå†…æ ¸çš„é»˜è®¤é…ç½®ä¼šè¾¾åˆ°40æ¯«ç§’ã€‚
# å¦‚æœé€‰æ‹©noï¼Œæ•°æ®ä¼ è¾“åˆ°salveçš„å»¶è¿Ÿå°†ä¼šå‡å°‘ä½†è¦ä½¿ç”¨æ›´å¤šçš„å¸¦å®½ã€‚
# é»˜è®¤æˆ‘ä»¬ä¼šä¸ºä½å»¶è¿Ÿåšä¼˜åŒ–ï¼Œä½†é«˜æµé‡æƒ…å†µæˆ–ä¸»ä»ä¹‹é—´çš„è·³æ•°è¿‡å¤šæ—¶ï¼Œå¯ä»¥è®¾ç½®ä¸ºâ€œyesâ€ã€‚
repl-disable-tcp-nodelay no
 
# è®¾ç½®æ•°æ®å¤‡ä»½çš„backlogå¤§å°
repl-backlog-size 1mb
 
# ä»æœ€åä¸€ä¸ªslaveæ–­å¼€å¼€å§‹è®¡æ—¶å¤šå°‘ç§’åï¼Œbacklogç¼“å†²å°†ä¼šé‡Šæ”¾ã€‚
repl-backlog-ttl 3600
 
# ä¼˜å…ˆçº§
replica-priority 100
 
# å¦‚æœmasterå°‘äºNä¸ªå»¶æ—¶å°äºç­‰äºMç§’çš„å·²è¿æ¥slaveï¼Œå°±å¯ä»¥åœæ­¢æ¥æ”¶å†™æ“ä½œã€‚
# Nä¸ªslaveéœ€è¦æ˜¯â€œonelineâ€çŠ¶æ€ã€‚
# å»¶æ—¶æ˜¯ä»¥ç§’ä¸ºå•ä½ï¼Œå¹¶ä¸”å¿…é¡»å°äºç­‰äºæŒ‡å®šå€¼ï¼Œæ˜¯ä»æœ€åä¸€ä¸ªä»slaveæ¥æ”¶åˆ°çš„pingï¼ˆé€šå¸¸æ¯ç§’å‘é€ï¼‰å¼€å§‹è®¡æ•°ã€‚
# è¯¥é€‰é¡¹ä¸ä¿è¯Nä¸ªslaveæ­£ç¡®åŒæ­¥å†™æ“ä½œï¼Œä½†æ˜¯é™åˆ¶æ•°æ®ä¸¢å¤±çš„çª—å£æœŸã€‚
# ä¾‹å¦‚è‡³å°‘éœ€è¦3ä¸ªå»¶æ—¶å°äºç­‰äº10ç§’çš„slaveç”¨ä¸‹é¢çš„æŒ‡ä»¤ï¼š
min-replicas-to-write 3
min-replicas-max-lag 10

#å†…å­˜æ»¡é€å‡º
lazyfree-lazy-eviction no
 
#è¿‡æœŸkeyåˆ é™¤
lazyfree-lazy-expire no
 
#å†…éƒ¨åˆ é™¤ï¼Œæ¯”å¦‚rename oldkey newkeyæ—¶ï¼Œå¦‚æœnewkeyå­˜åœ¨éœ€è¦åˆ é™¤newkey
lazyfree-lazy-server-del no
 
#æ¥æ”¶å®ŒRDBæ–‡ä»¶åæ¸…ç©ºæ•°æ®é€‰é¡¹
replica-lazy-flush no
 
# è®°å½•è¶…è¿‡å¤šå°‘å¾®ç§’çš„æŸ¥è¯¢å‘½ä»¤
# 1000000ç­‰äº1ç§’ï¼Œè®¾ç½®ä¸º0åˆ™è®°å½•æ‰€æœ‰å‘½ä»¤
slowlog-log-slower-than 10000
 
# è®°å½•å¤§å°ï¼Œå¯é€šè¿‡SLOWLOG RESETå‘½ä»¤é‡ç½®
slowlog-max-len 128

# å¼€å¯redisé›†ç¾¤
cluster-enabled yes
 
# é…ç½®redisè‡ªåŠ¨ç”Ÿæˆçš„é›†ç¾¤é…ç½®æ–‡ä»¶åã€‚ç¡®ä¿åŒä¸€ç³»ç»Ÿä¸­è¿è¡Œçš„å„rediså®ä¾‹è¯¥é…ç½®æ–‡ä»¶ä¸è¦é‡åã€‚
cluster-config-file nodes-6379.conf
 
# é›†ç¾¤èŠ‚ç‚¹è¶…æ—¶æ¯«ç§’æ•°
cluster-node-timeout 15000
 
# å¦‚æœæ•°æ®å¤ªæ—§ï¼Œé›†ç¾¤ä¸­çš„ä¸å¯ç”¨masterçš„slaveèŠ‚ç‚¹ä¼šé¿å…æˆä¸ºå¤‡ç”¨masterã€‚å¦‚æœslaveå’Œmasterå¤±è”æ—¶é—´è¶…è¿‡:(node-timeout * slave-validity-factor) + repl-ping-slave-periodåˆ™ä¸ä¼šè¢«æå‡ä¸ºmasterã€‚
# å¦‚node-timeoutä¸º30ç§’ï¼Œslave-validity-factorä¸º10, é»˜è®¤default repl-ping-slave-periodä¸º10ç§’,å¤±è”æ—¶é—´è¶…è¿‡310ç§’slaveå°±ä¸ä¼šæˆä¸ºmasterã€‚
# è¾ƒå¤§çš„slave-validity-factorå€¼å¯èƒ½å…è®¸åŒ…å«è¿‡æ—§æ•°æ®çš„slaveæˆä¸ºmasterï¼ŒåŒæ—¶è¾ƒå°çš„å€¼å¯èƒ½ä¼šé˜»æ­¢é›†ç¾¤é€‰ä¸¾å‡ºæ–°masterã€‚
# ä¸ºäº†è¾¾åˆ°æœ€å¤§é™åº¦çš„é«˜å¯ç”¨æ€§ï¼Œå¯ä»¥è®¾ç½®ä¸º0ï¼Œå³slaveä¸ç®¡å’Œmasterå¤±è”å¤šä¹…éƒ½å¯ä»¥æå‡ä¸ºmaster
cluster-replica-validity-factor 10
 
# åªæœ‰åœ¨ä¹‹å‰masteræœ‰å…¶å®ƒæŒ‡å®šæ•°é‡çš„å·¥ä½œçŠ¶æ€ä¸‹çš„slaveèŠ‚ç‚¹æ—¶ï¼ŒslaveèŠ‚ç‚¹æ‰èƒ½æå‡ä¸ºmasterã€‚é»˜è®¤ä¸º1ï¼ˆå³è¯¥é›†ç¾¤è‡³å°‘æœ‰3ä¸ªèŠ‚ç‚¹ï¼Œ1 masterï¼‹2 slavesï¼Œmasterå®•æœºï¼Œä»æœ‰å¦å¤–1ä¸ªslaveçš„æƒ…å†µä¸‹å…¶ä¸­1ä¸ªslaveå¯ä»¥æå‡ï¼‰
# æµ‹è¯•ç¯å¢ƒå¯è®¾ç½®ä¸º0ï¼Œç”Ÿæˆç¯å¢ƒä¸­è‡³å°‘è®¾ç½®ä¸º1
cluster-migration-barrier 1
 
# é»˜è®¤æƒ…å†µä¸‹å¦‚æœredisé›†ç¾¤å¦‚æœæ£€æµ‹åˆ°è‡³å°‘æœ‰1ä¸ªhash slotä¸å¯ç”¨ï¼Œé›†ç¾¤å°†åœæ­¢æŸ¥è¯¢æ•°æ®ã€‚
# å¦‚æœæ‰€æœ‰slotæ¢å¤åˆ™é›†ç¾¤è‡ªåŠ¨æ¢å¤ã€‚
# å¦‚æœéœ€è¦é›†ç¾¤éƒ¨åˆ†å¯ç”¨æƒ…å†µä¸‹ä»å¯æä¾›æŸ¥è¯¢æœåŠ¡ï¼Œè®¾ç½®ä¸ºnoã€‚
cluster-require-full-coverage yes
 
# é€‰é¡¹è®¾ç½®ä¸ºyesæ—¶ï¼Œä¼šé˜»æ­¢replicaså°è¯•å¯¹å…¶masteråœ¨ä¸»æ•…éšœæœŸé—´è¿›è¡Œæ•…éšœè½¬ç§»
# ç„¶è€Œï¼Œmasterä»ç„¶å¯ä»¥æ‰§è¡Œæ‰‹åŠ¨æ•…éšœè½¬ç§»,å¦‚æœå¼ºåˆ¶è¿™æ ·åšçš„è¯ã€‚
cluster-replica-no-failover no

# é»˜è®¤æ˜¯ä¸å¼€å¯aofæ¨¡å¼çš„
# é»˜è®¤æ˜¯ä½¿ç”¨rdbæ–¹å¼æŒä¹…åŒ–çš„ï¼Œåœ¨å¤§éƒ¨åˆ†æ‰€æœ‰çš„æƒ…å†µä¸‹ï¼Œrdbå®Œå…¨å¤Ÿç”¨ï¼
appendonly no 
 
# æŒä¹…åŒ–çš„æ–‡ä»¶çš„åå­—
appendfilename "appendonly.aof" 
 
# AOF åŒæ­¥é¢‘ç‡è®¾ç½®
# æ¯æ¬¡ä¿®æ”¹éƒ½ä¼š syncã€‚æ¶ˆè€—æ€§èƒ½  æ¯æ¬¡å†™æ“ä½œéƒ½ç«‹åˆ»å†™å…¥åˆ°aofæ–‡ä»¶ã€‚æ…¢ï¼Œä½†æ˜¯æœ€å®‰å…¨
appendfsync always 
 
# æ¯ç§’æ‰§è¡Œä¸€æ¬¡ syncï¼Œå¯èƒ½ä¼šä¸¢å¤±è¿™1sçš„æ•°æ®ï¼ æ¯ç§’å†™ä¸€æ¬¡ã€‚æŠ˜ä¸­æ–¹æ¡ˆ
appendfsync everysec 
 
# ä¸æ‰§è¡Œ syncï¼Œè¿™ä¸ªæ—¶å€™æ“ä½œç³»ç»Ÿè‡ªå·±åŒæ­¥æ•°æ®ï¼Œé€Ÿåº¦æœ€å¿«ï¼ä¸è¦ç«‹åˆ»åˆ·ï¼Œåªæœ‰åœ¨æ“ä½œç³»ç»Ÿéœ€è¦åˆ·çš„æ—¶å€™å†åˆ·ã€‚æ¯”è¾ƒå¿«
appendfsync no 
 
# å¦‚æœAOFçš„åŒæ­¥ç­–ç•¥è®¾ç½®æˆ â€œalwaysâ€ æˆ–è€… â€œeverysecâ€ï¼Œå¹¶ä¸”åå°çš„å­˜å‚¨è¿›ç¨‹ï¼ˆåå°å­˜å‚¨æˆ–å†™å…¥AOF æ—¥å¿—ï¼‰ä¼šäº§ç”Ÿå¾ˆå¤šç£ç›˜I/Oå¼€é”€ã€‚æŸäº›Linuxçš„é…ç½®ä¸‹ä¼šä½¿Rediså› ä¸º fsync()ç³»ç»Ÿè°ƒç”¨è€Œé˜»å¡å¾ˆä¹…ã€‚
# æ³¨æ„ï¼Œç›®å‰å¯¹è¿™ä¸ªæƒ…å†µè¿˜æ²¡æœ‰å®Œç¾ä¿®æ­£ï¼Œç”šè‡³ä¸åŒçº¿ç¨‹çš„ fsync() ä¼šé˜»å¡æˆ‘ä»¬åŒæ­¥çš„write(2)è°ƒç”¨ã€‚
# ä¸ºäº†ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªé€‰é¡¹ã€‚å®ƒå¯ä»¥åœ¨ BGSAVE æˆ– BGREWRITEAOF å¤„ç†æ—¶é˜»æ­¢fsync()ã€‚
# è¿™å°±æ„å‘³ç€å¦‚æœæœ‰å­è¿›ç¨‹åœ¨è¿›è¡Œä¿å­˜æ“ä½œï¼Œé‚£ä¹ˆRediså°±å¤„äº"ä¸å¯åŒæ­¥"çš„çŠ¶æ€ã€‚
# è¿™å®é™…ä¸Šæ˜¯è¯´ï¼Œåœ¨æœ€å·®çš„æƒ…å†µä¸‹å¯èƒ½ä¼šä¸¢æ‰30ç§’é’Ÿçš„æ—¥å¿—æ•°æ®ã€‚ï¼ˆé»˜è®¤Linuxè®¾å®šï¼‰
# å¦‚æœæŠŠè¿™ä¸ªè®¾ç½®æˆ"yes"å¸¦æ¥äº†å»¶è¿Ÿé—®é¢˜ï¼Œå°±ä¿æŒ"no"ï¼Œè¿™æ˜¯ä¿å­˜æŒä¹…æ•°æ®çš„æœ€å®‰å…¨çš„æ–¹å¼ã€‚
no-appendfsync-on-rewrite no
 
# è‡ªåŠ¨é‡å†™AOFæ–‡ä»¶ã€‚å¦‚æœAOFæ—¥å¿—æ–‡ä»¶å¢å¤§åˆ°æŒ‡å®šç™¾åˆ†æ¯”ï¼ŒRedisèƒ½å¤Ÿé€šè¿‡ BGREWRITEAOF è‡ªåŠ¨é‡å†™AOFæ—¥å¿—æ–‡ä»¶ã€‚
# å·¥ä½œåŸç†ï¼šRedisè®°ä½ä¸Šæ¬¡é‡å†™æ—¶AOFæ–‡ä»¶çš„å¤§å°ï¼ˆå¦‚æœé‡å¯åè¿˜æ²¡æœ‰å†™æ“ä½œï¼Œå°±ç›´æ¥ç”¨å¯åŠ¨æ—¶çš„AOFå¤§å°ï¼‰
# è¿™ä¸ªåŸºå‡†å¤§å°å’Œå½“å‰å¤§å°åšæ¯”è¾ƒã€‚å¦‚æœå½“å‰å¤§å°è¶…è¿‡æŒ‡å®šæ¯”ä¾‹ï¼Œå°±ä¼šè§¦å‘é‡å†™æ“ä½œã€‚
# ä½ è¿˜éœ€è¦æŒ‡å®šè¢«é‡å†™æ—¥å¿—çš„æœ€å°å°ºå¯¸ï¼Œè¿™æ ·é¿å…äº†è¾¾åˆ°æŒ‡å®šç™¾åˆ†æ¯”ä½†å°ºå¯¸ä»ç„¶å¾ˆå°çš„æƒ…å†µè¿˜è¦é‡å†™ã€‚
# æŒ‡å®šç™¾åˆ†æ¯”ä¸º0ä¼šç¦ç”¨AOFè‡ªåŠ¨é‡å†™ç‰¹æ€§ã€‚
auto-aof-rewrite-percentage 100

# æ–‡ä»¶è¾¾åˆ°å¤§å°é˜ˆå€¼çš„æ—¶å€™è¿›è¡Œé‡å†™
auto-aof-rewrite-min-size 64mb
 
# å¦‚æœè®¾ç½®ä¸ºyesï¼Œå¦‚æœä¸€ä¸ªå› å¼‚å¸¸è¢«æˆªæ–­çš„AOFæ–‡ä»¶è¢«rediså¯åŠ¨æ—¶åŠ è½½è¿›å†…å­˜ï¼Œrediså°†ä¼šå‘é€æ—¥å¿—é€šçŸ¥ç”¨æˆ·
# å¦‚æœè®¾ç½®ä¸ºnoï¼Œrediså°†ä¼šæ‹’ç»å¯åŠ¨ã€‚æ­¤æ—¶éœ€è¦ç”¨"redis-check-aof"å·¥å…·ä¿®å¤æ–‡ä»¶ã€‚
aof-load-truncated yes
 
# åŠ è½½æ—¶Redisè¯†åˆ«å‡ºAOFæ–‡ä»¶ä»¥â€œREDISâ€å¼€å¤´å­—ç¬¦ä¸²ï¼Œ
# å¹¶åŠ è½½å¸¦æ­¤å‰ç¼€çš„RDBæ–‡ä»¶ï¼Œç„¶åç»§ç»­åŠ è½½AOF
aof-use-rdb-preamble yes
```

## äº”ã€Redis çš„æ•°æ®ç±»å‹

æ“ä½œ Redis çš„æ•°æ®ç±»å‹çš„å‘½ä»¤å‚è€ƒå®˜ç½‘ï¼šhttps://redis.io/docs/latest/commands/ï¼Œæ¯æ¡å‘½ä»¤è§£é‡Šéå¸¸è¯¦ç»†ï¼Œä»¥ä¸‹æ˜¯éƒ¨åˆ†å¸¸ç”¨å‘½ä»¤ã€‚

### 5.1ã€å­—ç¬¦ä¸²ç±»å‹ï¼ˆStringï¼‰

#### 5.1.1ã€set / get 

```bash
set key value # è®¾ç½® key çš„ value å€¼
get key # è·å–å¯¹åº” key çš„ value å€¼
```

#### 5.1.2ã€mset / mget 

```bash
mset s1 value1 s2 value2 # åŒæ—¶è®¾ç½®å¤šä¸ªé”®å€¼å¯¹
mget s1 s2 # åŒæ—¶è·å–å¤šä¸ªé”®å€¼å¯¹
```

#### 5.1.3ã€getrange / setrange 

```bash
getrange s1 0 2 # è·å– s1 çš„ value å€¼çš„ 0-2 åŒºé—´çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ â€œvalâ€
setrange s1 2 119 # å°† s1 çš„ value å€¼ä» 2ï¼ˆoffsetï¼‰å¼€å§‹æ›¿æ¢ä¸º 119
```

![image-20241230195838572](images/image-20241230195838572.png)

#### 5.1.4ã€incr / decr | incrby / decrby 

![image-20241230200315169](images/image-20241230200315169.png)

ğŸ””æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ“ä½œï¼Œå› ä¸º Redis æ²¡æœ‰ä¸“ç”¨çš„æ•´æ•°ç±»å‹ã€‚å­˜å‚¨åœ¨å¯†é’¥ä¸­çš„å­—ç¬¦ä¸²è¢«è§£é‡Šä¸ºåŸºæ•°ä¸º 10 çš„ 64 ä½å¸¦ç¬¦å·æ•´æ•°æ¥æ‰§è¡Œæ“ä½œã€‚

Redis ä»¥æ•´æ•°è¡¨ç¤ºå½¢å¼å­˜å‚¨æ•´æ•°ï¼Œå› æ­¤å¯¹äºå®é™…ä¿å­˜æ•´æ•°çš„å­—ç¬¦ä¸²å€¼ï¼Œå­˜å‚¨æ•´æ•°çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ²¡æœ‰å¼€é”€ã€‚

#### 5.1.5ã€STRLEN 

```bash
STRLEN s1 # è·å–å­—ç¬¦ä¸²çš„é•¿åº¦
```

#### 5.1.6ã€APPEND

![image-20241230201546929](images/image-20241230201546929.png)

å¦‚æœ key å·²ç»å­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™è¯¥å‘½ä»¤å°†å€¼é™„åŠ åœ¨å­—ç¬¦ä¸²çš„æœ«å°¾ã€‚å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ƒå¹¶å°†å…¶è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå› æ­¤APPEND åœ¨è¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹ç±»ä¼¼äº setã€‚

### 5.2ã€åˆ—è¡¨ï¼ˆListï¼‰

åˆ—è¡¨æ˜¯ä¸€ä¸ªåŒç«¯é“¾è¡¨ç»„æˆçš„

#### 5.2.1ã€lpush / rpush / lrange

å°†æ‰€æœ‰æŒ‡å®šçš„å€¼æ’å…¥åˆ°å­˜å‚¨ä¸º key çš„åˆ—è¡¨çš„å¤´éƒ¨ã€‚å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™åœ¨æ‰§è¡Œ push æ“ä½œä¹‹å‰å°†å…¶åˆ›å»ºä¸ºç©ºåˆ—è¡¨ã€‚å¦‚æœ key ä¿å­˜çš„å€¼ä¸æ˜¯åˆ—è¡¨ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚

```bash
RPUSH mylist "one" "two" # å³æ’å…¥ï¼šä»æœ€å³è¾¹çš„å…ƒç´ åˆ°æœ€å·¦è¾¹çš„å…ƒç´ ï¼Œå…ƒç´ ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ’å…¥åˆ°åˆ—è¡¨çš„å¤´éƒ¨
LPUSH mylist a b c # å·¦æ’å…¥ï¼šä»æœ€å·¦è¾¹çš„å…ƒç´ åˆ°æœ€å³è¾¹çš„å…ƒç´ ï¼Œå…ƒç´ ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ’å…¥åˆ°åˆ—è¡¨çš„å¤´éƒ¨
```

![image-20241230211630665](images/image-20241230211630665.png)

```bash
LRANGE key start stop # æŸ¥æ‰¾
```

è¿”å›å­˜å‚¨åœ¨ key å¤„çš„åˆ—è¡¨çš„æŒ‡å®šå…ƒç´ ã€‚åç§»é‡å¼€å§‹å’Œåœæ­¢æ˜¯åŸºäº 0 çš„ç´¢å¼•ï¼Œå…¶ä¸­ 0 æ˜¯åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆåˆ—è¡¨çš„å¤´éƒ¨ï¼‰ï¼Œ1 æ˜¯ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œä¾æ­¤ç±»æ¨ã€‚

è¿™äº›åç§»é‡ä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ï¼Œè¡¨ç¤ºä»åˆ—è¡¨æœ«å°¾å¼€å§‹çš„åç§»é‡ã€‚ä¾‹å¦‚ï¼Œ-1 æ˜¯åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ-2 æ˜¯å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä»¥æ­¤ç±»æ¨

#### 5.2.2ã€lindex

```bash
lindex mylist 1 # æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å–å…ƒç´ 
```

#### 5.2.3ã€llen

```bash
llen mylist # è·å–åˆ—è¡¨å…ƒç´ ä¸ªæ•°
```

#### 5.2.4ã€lpop / rpop

```bash
lpop key # å·¦åˆ é™¤ï¼Œåˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›è¢«åˆ é™¤çš„å…ƒç´ 
rpop key # å³åˆ é™¤ï¼Œåˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›è¢«åˆ é™¤çš„å…ƒç´ 
```

![image-20241230214234971](images/image-20241230214234971.png)

#### 5.2.5ã€lset

```bash
lset mylist 0 abc # ä¿®æ”¹å¯¹åº”ç´¢å¼•çš„å…ƒç´ 
```

#### 5.2.6ã€linsert

```bash
LINSERT key <BEFORE | AFTER> pivot element # åœ¨å¼•ç”¨å€¼pivotä¹‹å‰æˆ–ä¹‹åçš„é”®å¤„å­˜å‚¨çš„åˆ—è¡¨ä¸­æ’å…¥å…ƒç´ ã€‚
```

![image-20241230221433726](images/image-20241230221433726.png)

å½“ key ä¸å­˜åœ¨æ—¶ï¼Œå®ƒè¢«è§†ä¸ºç©ºåˆ—è¡¨ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œå½“keyå­˜åœ¨ä½†ä¸åŒ…å«åˆ—è¡¨å€¼æ—¶è¿”å›é”™è¯¯ã€‚

#### 5.2.7ã€lrem

```bash
LREM key count element # ç§»é™¤åˆ—è¡¨æŒ‡å®šå€¼çš„åˆ—è¡¨
```

`key` æ˜¯è¦æ“ä½œçš„åˆ—è¡¨çš„é”®ã€‚

`count` æ˜¯è¦ç§»é™¤çš„å…ƒç´ ä¸ªæ•°ã€‚æœ‰ä¸‰ç§æƒ…å†µï¼š

+ å¦‚æœ `count` å¤§äº 0ï¼Œåˆ™ä»åˆ—è¡¨çš„å¤´éƒ¨å¼€å§‹å‘å°¾éƒ¨ç§»é™¤å€¼ä¸º `value` çš„å…ƒç´ ï¼Œæœ€å¤šç§»é™¤ `count` ä¸ª
+ å¦‚æœ `count` å°äº 0ï¼Œåˆ™ä»åˆ—è¡¨çš„å°¾éƒ¨å¼€å§‹å‘å¤´éƒ¨ç§»é™¤å€¼ä¸º `value` çš„å…ƒç´ ï¼Œæœ€å¤šç§»é™¤ `count` çš„ç»å¯¹å€¼ä¸ª
+ å¦‚æœ `count` ç­‰äº 0ï¼Œåˆ™ç§»é™¤æ‰€æœ‰å€¼ä¸º `value` çš„å…ƒç´ 

`value` æ˜¯è¦ç§»é™¤çš„å…ƒç´ çš„å€¼

![image-20241230222818065](images/image-20241230222818065.png)

### 5.3ã€å“ˆå¸Œï¼ˆHashï¼‰

#### 5.3.1ã€hset / hget / hmset / hmget

è®¾ç½®å“ˆå¸Œå€¼

![image-20241230223829760](images/image-20241230223829760.png)

#### 5.3.2ã€hgetall / hdel

```bash
hgetall h1 # æŸ¥çœ‹å¯¹åº” key çš„æ‰€æœ‰hash
hdel h1 id # åˆ é™¤hash
```

![image-20241230225030206](images/image-20241230225030206.png)

#### 5.3.3ã€hlen

```bash
hlen h1 # è·å–æŸä¸ª key å†…çš„å…¨éƒ¨æ•°é‡
```

#### 5.3.4ã€hkeys / hvals

```bash
hkeys h1 # è·å–æŸä¸ª key å†…çš„key
hvals h1 # è·å–æŸä¸ª key å†…çš„value
```

![image-20241230230332172](images/image-20241230230332172.png)

#### 5.3.5ã€hexists

```bash
hexists h1 age # åˆ¤æ–­æŸä¸ª key å†…çš„ key å€¼æ˜¯å¦å­˜åœ¨
```

### 5.4ã€é›†åˆï¼ˆSetï¼‰

```bash
# å¾€mysetå­˜å…¥ä¸€ä¸ªå€¼hello
SADD myset hello
# æŸ¥çœ‹å½“å‰ set æ‰€æœ‰å…ƒç´ 
SMEMBER myset
# æŸ¥çœ‹å½“å‰setæ˜¯å¦åŒ…å«helloå…ƒç´ 
SISMEMBER myset hello
# è·å–setçš„size
SCARD myset
# ç§»é™¤mysetçš„helloå…ƒç´ 
SREM myset hello
# éšæœºè·å–setä¸­çš„ä¸€ä¸ªå…ƒç´ 
SRANDMEMBER myset 1
# éšæœºè·å–ä¸€ä¸ªå…ƒç´ å¹¶åˆ é™¤å®ƒ
SPOP nyset
# å°†æ¥ä¸€ä¸ªæŒ‡å®šçš„å…ƒç´ ç§»åŠ¨åˆ°å¦å¤–çš„setä¸­
SMOVE myset myset2 sdfa # å°†mysetä¸­çš„sdfaç§»åŠ¨åˆ°myset2ä¸­
# è·å– set1 ä¸ set3 çš„å·®é›†
SDIFF set1 set3
# è·å– set1 ä¸ set3 çš„äº¤é›†
SINTER set1 set3
# è·å– set1 ä¸ set3 çš„å¹¶é›†
SUNION set1 set3
```

### 5.5ã€è¿‡æœŸé”®ï¼ˆExpiring Keysï¼‰
#### 5.5.1ã€EXPIREå’ŒSETå‘½ä»¤è®¾ç½®è¿‡æœŸæ—¶é—´

```bash
EXPIRE key seconds # EXPIRE å‘½ä»¤ç”¨äºä¸ºå·²å­˜åœ¨çš„é”®è®¾ç½®è¿‡æœŸæ—¶é—´ã€seconds æ˜¯é”®åœ¨å¤šå°‘ç§’åè¿‡æœŸ
SET myKey "Hello, World" EX 60 # SET å‘½ä»¤ä¹Ÿå¯ä»¥ç”¨æ¥åœ¨è®¾ç½®é”®å€¼çš„åŒæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚ä½ å¯ä»¥ä½¿ç”¨ EX æˆ– PX é€‰é¡¹æ¥æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼Œå…¶ä¸­ EX åé¢è·Ÿçš„æ˜¯ç§’æ•°ï¼Œè€Œ PX åé¢è·Ÿçš„æ˜¯æ¯«ç§’æ•°ã€‚
```

#### 5.5.2ã€TTLå‘½ä»¤

```bash
TTL myKey # å¦‚æœé”®ä¸å­˜åœ¨æˆ–æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå°†è¿”å› -2ã€‚å¦‚æœé”®å·²ç»è¿‡æœŸå¹¶è¢«è‡ªåŠ¨åˆ é™¤ï¼Œå°†è¿”å› -1
```

#### 5.5.3ã€ç§»é™¤è¿‡æœŸ

```bash
PERSIST myKey
```

## å…­ã€Redis äº‹åŠ¡

Redis äº‹åŠ¡çš„æœ¬è´¨æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆã€‚äº‹åŠ¡æ”¯æŒä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ã€‚åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæŒ‰ç…§é¡ºåºä¸²è¡ŒåŒ–æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤è¯·æ±‚ä¸ä¼šæ’å…¥åˆ°äº‹åŠ¡æ‰§è¡Œå‘½ä»¤åºåˆ—ä¸­ã€‚

æ€»ç»“è¯´ï¼šRedis äº‹åŠ¡å°±æ˜¯ä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§çš„æ‰§è¡Œä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„ä¸€ç³»åˆ—å‘½ä»¤ã€‚

| å‘½ä»¤    | äº‹åŠ¡                                                         |
| ------- | ------------------------------------------------------------ |
| multi   | å¼€å¯äº‹åŠ¡ï¼Œredis ä¼šå°†åç»­çš„å‘½ä»¤é€ä¸ªæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åä½¿ç”¨ exec å‘½ä»¤æ¥åŸå­åŒ–æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ç³»åˆ— |
| exec    | æ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œå‘½ä»¤                                     |
| discard | å–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡å—ä¸­çš„æ‰€æœ‰å‘½ä»¤                         |
| watch   | ç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ª keyï¼Œå¦‚æœäº‹åŠ¡åœ¨æ‰§è¡Œå‰ï¼Œè¿™ä¸ª key (æˆ–å¤šä¸ª key) è¢«å…¶ä»–å‘½ä»¤ä¿®æ”¹ï¼Œåˆ™äº‹åŠ¡è¢«ä¸­æ–­ï¼Œä¸ä¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„ä»»ä½•å‘½ä»¤ |
| unwatch | å–æ¶ˆ watch å¯¹æ‰€æœ‰ key çš„ç›‘è§†                                 |

### 6.1ã€äº‹åŠ¡æ‰§è¡Œ

![image-20250406210717938](images/image-20250406210717938.png)

### 6.2ã€äº‹åŠ¡å–æ¶ˆ

![image-20250406210823024](images/image-20250406210823024.png)

### 6.3ã€äº‹åŠ¡ä¸­é”™è¯¯å¤„ç†

#### 6.3.1ã€è¯­æ³•é”™è¯¯

![image-20250406211019692](images/image-20250406211019692.png)

è¯­æ³•é”™è¯¯ï¼Œæœ€ç»ˆå¯¼è‡´äº‹åŠ¡æäº¤å¤±è´¥ï¼Œk1 å’Œ k2 ä¿ç•™åŸå€¼

#### 6.3.2ã€ç±»å‹é”™è¯¯ï¼ˆè¿è¡Œæ—¶é”™è¯¯ï¼‰

![image-20250406211917442](images/image-20250406211917442.png)

åœ¨è¿è¡Œæ—¶æ£€æµ‹ç±»å‹é”™è¯¯ï¼Œæœ€ç»ˆå¯¼è‡´äº‹åŠ¡æäº¤å¤±è´¥ï¼Œæ­¤æ—¶äº‹åŠ¡å¹¶æ²¡æœ‰å›æ»šï¼Œè€Œæ˜¯è·³è¿‡é”™è¯¯å‘½ä»¤ç»§ç»­æ‰§è¡Œï¼Œ ç»“æœ k1 å€¼æ”¹å˜ã€k2 ä¿ç•™åŸå€¼

### 6.4ã€watch å‘½ä»¤

è¢« watch çš„é”®ä¼šè¢«ç›‘è§†ï¼Œå¹¶ä¼šå‘è§‰è¿™äº›é”®æ˜¯å¦è¢«æ”¹åŠ¨è¿‡äº†ã€‚ å¦‚æœæœ‰è‡³å°‘ä¸€ä¸ªè¢«ç›‘è§†çš„é”®åœ¨ exec æ‰§è¡Œä¹‹å‰è¢«ä¿®æ”¹äº†ï¼Œ é‚£ä¹ˆæ•´ä¸ªäº‹åŠ¡éƒ½ä¼šè¢«å–æ¶ˆï¼Œ exec è¿”å› nil-reply æ¥è¡¨ç¤ºäº‹åŠ¡å·²ç»å¤±è´¥ã€‚

redis ä½¿ç”¨ watch å‘½ä»¤æ¥å†³å®šäº‹åŠ¡æ˜¯ç»§ç»­æ‰§è¡Œè¿˜æ˜¯å›æ»šï¼Œé‚£å°±éœ€è¦åœ¨ multi ä¹‹å‰ä½¿ç”¨ watch æ¥ç›‘æ§æŸäº›é”®å€¼å¯¹ï¼Œç„¶åä½¿ç”¨ multi å‘½ä»¤æ¥å¼€å¯äº‹åŠ¡ï¼Œæ‰§è¡Œå¯¹æ•°æ®ç»“æ„æ“ä½œçš„å„ç§å‘½ä»¤ï¼Œæ­¤æ—¶è¿™äº›å‘½ä»¤å…¥é˜Ÿåˆ—ã€‚

å½“ä½¿ç”¨ exec æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œé¦–å…ˆä¼šæ¯”å¯¹ watch æ‰€ç›‘æ§çš„é”®å€¼å¯¹ï¼Œå¦‚æœæ²¡å‘ç”Ÿæ”¹å˜ï¼Œå®ƒä¼šæ‰§è¡Œäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼Œæäº¤äº‹åŠ¡ï¼›å¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œå°†ä¸ä¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„ä»»ä½•å‘½ä»¤ï¼ŒåŒæ—¶äº‹åŠ¡å›æ»šã€‚å½“ç„¶æ— è®ºæ˜¯å¦å›æ»šï¼Œredis éƒ½ä¼šå–æ¶ˆæ‰§è¡Œäº‹åŠ¡å‰çš„ watch å‘½ä»¤ã€‚

![image-20250406213133083](images/image-20250406213133083.png)

## ä¸ƒã€Redis æŒä¹…åŒ–åŸç†

Redis çš„è¯»å†™éƒ½æ˜¯åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥å®ƒçš„æ€§èƒ½è¾ƒé«˜ï¼Œä½†åœ¨å†…å­˜ä¸­çš„æ•°æ®ä¼šéšç€æœåŠ¡å™¨çš„é‡å¯è€Œä¸¢å¤±ï¼Œä¸ºäº†ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œæˆ‘ä»¬éœ€è¦å°†å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ï¼Œä»¥ä¾¿ Redis é‡å¯æ—¶èƒ½å¤Ÿä»ç£ç›˜ä¸­æ¢å¤åŸæœ‰çš„æ•°æ®ï¼Œè€Œæ•´ä¸ªè¿‡ç¨‹å°±å«åš Redis æŒä¹…åŒ–ã€‚

Redis çš„æŒä¹…åŒ–ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼šRDBï¼ˆRedis Databaseï¼‰å’Œ AOFï¼ˆAppend Only Fileï¼‰ã€‚è¿™ä¸¤ç§æœºåˆ¶å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œå¯ä»¥æ ¹æ®å®é™…ä½¿ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„æŒä¹…åŒ–ç­–ç•¥ã€‚

### 7.1ã€RDB æŒä¹…åŒ–

RDB æŒä¹…åŒ–æ˜¯å°† Redis åœ¨å†…å­˜ä¸­çš„æ•°æ®åº“çŠ¶æ€ä»¥å¿«ç…§ï¼ˆsnapshotï¼‰çš„å½¢å¼ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šçš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥é€šè¿‡é…ç½®è§¦å‘ï¼Œä¾‹å¦‚æ‰‹åŠ¨æ‰§è¡Œ SAVE/Bgsave å‘½ä»¤ï¼Œæˆ–è€…é…ç½® Redis åœ¨ç‰¹å®šæ¡ä»¶ä¸‹è‡ªåŠ¨è§¦å‘ï¼Œå¦‚é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„"è„"ï¼ˆdirtyï¼‰æ•°æ®è¶…è¿‡ä¸€å®šæ•°é‡æˆ–è€…è¾¾åˆ°ä¸€å®šæ—¶é—´é—´éš”ã€‚

ä¼˜ç‚¹ï¼š

- æ¢å¤é€Ÿåº¦å¿«ï¼Œå› ä¸ºåªéœ€è¦è¯»å–ä¸€ä¸ªæ–‡ä»¶å³å¯æ¢å¤ã€‚
- é€‚åˆç¾éš¾æ¢å¤ã€‚

ç¼ºç‚¹ï¼š

- å¯èƒ½ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§ä¹‹åçš„æ•°æ®ï¼Œå› ä¸ºå®ƒæ˜¯é—´éš”æ€§ä¿å­˜ã€‚
- æ— æ³•å®ç°ç§’çº§æŒä¹…åŒ–ã€‚

é…ç½®ç¤ºä¾‹ï¼š

```bash
# 900ç§’å†…å¦‚æœè‡³å°‘æœ‰1ä¸ªkeyæ”¹å˜ï¼Œåˆ™è¿›è¡Œdump
save 900 1
# 300ç§’å†…å¦‚æœè‡³å°‘æœ‰10ä¸ªkeyæ”¹å˜ï¼Œåˆ™è¿›è¡Œdump
save 300 10
# 60ç§’å†…å¦‚æœè‡³å°‘æœ‰10000ä¸ªkeyæ”¹å˜ï¼Œåˆ™è¿›è¡Œdump
save 60 10000
```

### 7.2ã€AOF æŒä¹…åŒ–

AOF æŒä¹…åŒ–è®°å½•äº† Redis æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ¯ä¸ªå†™æ“ä½œï¼ˆä¾‹å¦‚ SET å’Œ LPUSHï¼‰ï¼Œå¹¶ä¸”ä»¥æ–‡æœ¬æ ¼å¼è¿½åŠ åˆ°æ–‡ä»¶ä¸­ã€‚å½“ Redis é‡å¯æ—¶ï¼Œå¯ä»¥é€šè¿‡é‡æ–°æ‰§è¡Œ AOF æ–‡ä»¶ä¸­çš„å‘½ä»¤æ¥é‡å»ºæ•°æ®é›†ã€‚

ä¼˜ç‚¹ï¼š

- å¯ä»¥æä¾›æ›´é«˜çš„æ•°æ®å®‰å…¨æ€§ï¼Œå‡ ä¹å¯ä»¥é¿å…æ•°æ®ä¸¢å¤±ã€‚
- æ”¯æŒæ›´é«˜çš„æŒä¹…åŒ–é¢‘ç‡ï¼Œä¾‹å¦‚æ¯ç§’åŒæ­¥ã€‚

ç¼ºç‚¹ï¼š

- æ–‡ä»¶ä½“ç§¯è¾ƒå¤§ï¼Œå› ä¸ºè®°å½•äº†æ‰€æœ‰çš„å†™æ“ä½œã€‚
- æ¢å¤é€Ÿåº¦è¾ƒæ…¢ï¼Œä¾èµ–äº AOF æ–‡ä»¶çš„å¤§å°å’Œå¤æ‚åº¦ã€‚

é…ç½®ç¤ºä¾‹ï¼š

```bash
appendonly yes  # å¼€å¯AOFæŒä¹…åŒ–
appendfsync everysec  # æ¯ç§’åŒæ­¥ä¸€æ¬¡
```

### 7.3ã€æ··åˆæŒä¹…åŒ–

ç»“åˆäº† RDB å’Œ AOF çš„ä¼˜ç‚¹ã€‚åœ¨å†™å…¥æ—¶ï¼Œå…ˆå°†å½“å‰çš„æ•°æ®ä»¥ RDB çš„å½¢å¼å†™å…¥æ–‡ä»¶çš„å¼€å¤´ï¼Œå†å°†åç»­çš„æ“ä½œå‘½ä»¤ä»¥ AOF çš„æ ¼å¼å­˜å…¥æ–‡ä»¶ã€‚è¿™æ ·æ—¢èƒ½ä¿è¯ Redis é‡å¯æ—¶çš„é€Ÿåº¦ï¼Œåˆèƒ½é™ä½æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚

åœ¨åŒæ—¶å¼€å¯ RDB å’Œ AOF æ—¶ï¼ŒRedisé‡å¯çš„æ—¶å€™åªä¼šåŠ è½½ AOF æ–‡ä»¶ï¼Œè€Œä¸ä¼šåŠ è½½ RDB æ–‡ä»¶ï¼ŒAOF æ–‡ä»¶çš„ä¼˜å…ˆçº§æ¯” RDB æ–‡ä»¶çš„ä¼˜å…ˆçº§é«˜ï¼Œåªæœ‰ AOF æ–‡ä»¶ä¸å­˜åœ¨çš„æ—¶å€™æ‰ä¼šè¯»å– RDB æ–‡ä»¶ã€‚

ä¼˜ç‚¹ï¼š

+ ç»“åˆäº† RDB å’Œ AOF çš„ä¼˜ç‚¹ï¼šæ··åˆæŒä¹…åŒ–ç»“åˆäº† RDB æŒä¹…åŒ–çš„æ•°æ®ç´§å‡‘æ€§å’Œ AOF æŒä¹…åŒ–çš„æ•°æ®å®‰å…¨æ€§ï¼Œæ—¢ä¿è¯äº†æ•°æ®çš„å¯é æ€§ï¼Œåˆæé«˜äº†æ•°æ®æ¢å¤çš„é€Ÿåº¦ã€‚
+ é™ä½äº†æ•°æ®ä¸¢å¤±çš„é£é™©ï¼šç”±äºæ··åˆæŒä¹…åŒ–ç»“åˆäº† AOF æŒä¹…åŒ–ï¼Œå› æ­¤å³ä½¿ Redis è¿›ç¨‹åœ¨ RDB å¿«ç…§ç”Ÿæˆä¹‹åå®•æœºï¼Œä¹Ÿå¯ä»¥é€šè¿‡ AOF æ–‡ä»¶æ¥æ¢å¤æ•°æ®ï¼Œé™ä½äº†æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚
+ æé«˜äº†é‡å¯é€Ÿåº¦ï¼šæ··åˆæŒä¹…åŒ–åœ¨ AOF æ–‡ä»¶çš„å‰åŠéƒ¨åˆ†åŒ…å«äº† RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼Œè¿™ä½¿å¾— Redis åœ¨é‡å¯æ—¶å¯ä»¥å…ˆåŠ è½½ RDB å¿«ç…§ï¼Œå¿«é€Ÿæ¢å¤åˆ°å®•æœºå‰çš„çŠ¶æ€ï¼Œç„¶åå†é€šè¿‡ AOF æ–‡ä»¶ä¸­çš„å¢é‡å‘½ä»¤æ¥æ¢å¤åç»­çš„æ•°æ®å˜æ›´ï¼Œä»è€Œæé«˜äº†é‡å¯é€Ÿåº¦

ç¼ºç‚¹ï¼š

- AOF æ–‡ä»¶å¯è¯»æ€§å˜å·®ï¼šç”±äºæ··åˆæŒä¹…åŒ–åœ¨ AOF æ–‡ä»¶çš„å‰åŠéƒ¨åˆ†æ·»åŠ äº† RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼Œè¿™ä½¿å¾— AOF æ–‡ä»¶çš„å¯è¯»æ€§å˜å·®ï¼Œä¸æ˜“äºé˜…è¯»å’Œè§£æã€‚
- ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ï¼šæ··åˆæŒä¹…åŒ–æ˜¯ Redis 4.0 ä¹‹åå¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œå› æ­¤åœ¨ä½¿ç”¨æ··åˆæŒä¹…åŒ–æ—¶ï¼Œéœ€è¦ç¡®ä¿ Redis çš„ç‰ˆæœ¬æ”¯æŒæ··åˆæŒä¹…åŒ–ã€‚å¦‚æœ Redis ç‰ˆæœ¬è¿‡ä½ï¼Œå¯èƒ½æ— æ³•æ­£ç¡®åŠ è½½æ··åˆæŒä¹…åŒ–ç”Ÿæˆçš„ AOF æ–‡ä»¶ã€‚
- å¯èƒ½å¢åŠ æŒä¹…åŒ–æ–‡ä»¶çš„å¤æ‚æ€§ï¼šæ··åˆæŒä¹…åŒ–ç”Ÿæˆçš„ AOF æ–‡ä»¶æ—¢åŒ…å«äº† RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼ŒåˆåŒ…å«äº† AOF æ ¼å¼çš„å¢é‡å‘½ä»¤ï¼Œè¿™ä½¿å¾— AOF æ–‡ä»¶çš„ç»“æ„å’Œå†…å®¹å˜å¾—æ›´åŠ å¤æ‚ã€‚åœ¨ç®¡ç†å’Œç»´æŠ¤æ—¶å¯èƒ½éœ€è¦æ›´å¤šçš„æ³¨æ„å’Œæ“ä½œã€‚

é…ç½®ç¤ºä¾‹ï¼š

```bash
appendonly yes  # å¼€å¯AOFæŒä¹…åŒ–
save 900 1      # åŒæ—¶é…ç½®RDBæŒä¹…åŒ–è§„åˆ™
```

## å…«ã€Redis çš„ä¸»ä»æ¶æ„

```bash
dpkg -L redis-server # æŸ¥æ‰¾ redis ç›¸å…³æ–‡ä»¶ï¼Œæ‰¾åˆ°é…ç½®æ–‡ä»¶
```

ç›¸å…³é…ç½®æ–‡ä»¶åœ¨  `/etc/redis/redis.conf`

```bash
sudo chmod 777 /etc/redis # ç»™ redis ç›®å½•æ·»åŠ æƒé™
```

ç„¶åå‚è€ƒ redis.conf æ–‡ä»¶å¤åˆ¶ redis6380.confã€redis6381.conf ã€redis6382.conf æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾

![image-20250104182105684](images/image-20250104182105684.png)

ç¼–å†™ redis6380.conf æ–‡ä»¶ï¼Œç¼–å†™å†…å®¹å¦‚ä¸‹ï¼Œredis6381.conf ã€redis6382.conf ä¾æ¬¡ç±»æ¨è¿›è¡Œä¿®æ”¹

```bash
include redis.conf

port 6380 # è®¾ç½®ç«¯å£å·
pidfile /run/redis/redis-server-6380.pid # é…ç½® redis çš„ pid
dbfilename dump6380.rdb # é…ç½® redis çš„ rdb æ–‡ä»¶
appendfilename appendonly6380.aof # é…ç½® redis çš„ aof æ–‡ä»¶
```

åœ¨ä¿®æ”¹æ–‡ä»¶ä¹‹å‰å»ºè®®æ˜¯å°†æ–‡ä»¶èµ‹äºˆä¿®æ”¹æ‰§è¡Œæƒé™

```bash
sudo chmod 777 redis6381.conf
```

ä¾æ¬¡å¯åŠ¨ Redis æœåŠ¡ï¼Œç«¯å£åˆ†åˆ«ä¸º 6380ã€6381ã€6382

```bash 
sudo redis-server redis6380.conf
sudo redis-server redis6381.conf
sudo redis-server redis6382.conf
```

æŸ¥æ‰¾ç›¸å…³ Redis çš„è¿›ç¨‹æœåŠ¡

```bash
ps aux | grep redis
```

![image-20250104185008080](images/image-20250104185008080.png)

å¦‚æœè¦è¿›å…¥æŸä¸ªç«¯å£çš„ Redis çš„å‘½ä»¤ç»ˆç«¯

```bash
redis-cli -p 6380 # è¿›å…¥ 6380 çš„ redis æœåŠ¡
```

æŸ¥çœ‹ Redis ä¸»ä»ä¿¡æ¯

```bash
info replication
```

![image-20250104185411091](images/image-20250104185411091.png)

è®© 6380 ç«¯å£çš„ redis æœåŠ¡ä½œä¸º master ï¼Œ6381ã€6382 ç«¯å£çš„ redis æœåŠ¡ä½œä¸º slave 

```bash
127.0.0.1:6381> slaveof 127.0.0.1 6380 # åœ¨ 6381 ç«¯å£æœåŠ¡è®¾ç½® 6380 ä½œä¸ºmaster
127.0.0.1:6382> slaveof 127.0.0.1 6380 # åœ¨ 6382 ç«¯å£æœåŠ¡è®¾ç½® 6380 ä½œä¸ºmaster
```

å¯ä»¥åœ¨ 6380 çš„ç«¯å£æŸ¥çœ‹ slave çš„æœåŠ¡ä¿¡æ¯

![image-20250104185829172](images/image-20250104185829172.png)

ç”±æ­¤ä»¥ä¸Šè¿‡ç¨‹å°±å®ç°äº†å•ä¸ªæœºå™¨é€šè¿‡ä¸åŒç«¯å£å®ç° Redis çš„ä¸»ä»æ¶æ„

å½“åœ¨ Redis çš„ master æœåŠ¡è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œå¯¹åº” slave å°±å¯ä»¥æŸ¥åˆ°ï¼Œé€šå¸¸ master åªèƒ½è¿›è¡Œå†™æ“ä½œï¼Œè€Œ slave åªèƒ½è¿›è¡Œè¯»æ“ä½œï¼Œå¦‚æœåœ¨ slave è¿›è¡Œå†™æ“ä½œä¼šå¯¼è‡´å†™å…¥ä¸æˆåŠŸ

![image-20250104190408848](images/image-20250104190408848.png)

å½“å…¶ä¸­çš„ master å’Œ slave å®•æœºæ—¶ï¼š

+ slave èŠ‚ç‚¹å®•æœºæ—¶ï¼Œmaster çš„ slaver èŠ‚ç‚¹å°±ä¼šå‡å°‘ä¸€ä¸ªï¼Œslave èŠ‚ç‚¹è¿›è¡Œé‡å¯æ—¶å°±ä¸å†æ˜¯slaveè€Œæ˜¯masterï¼Œéœ€è¦é‡æ–°é…ç½® slaveof host
+ master èŠ‚ç‚¹å®•æœºæ—¶ï¼Œslave èŠ‚ç‚¹ä¾æ—§æ˜¯ slave ï¼Œä½†æ˜¯èŠ‚ç‚¹ä¼šæè¿° master_link_status:down çŠ¶æ€ã€‚å½“ master èŠ‚ç‚¹é‡å¯æ—¶ï¼ŒèŠ‚ç‚¹ä¼šæè¿° master_link_status:up çŠ¶æ€
+ slave èŠ‚ç‚¹å¯ä»¥é€šè¿‡ slaveof no one ç”± slave æ™‹å‡ä¸º master

ç¼–å†™ Redis å¯åœè„šæœ¬ï¼Œè¾…åŠ©å¿«é€Ÿå¯åŠ¨ï¼Œå› ä¸ºå½“å‰æ—¶ä¼ªé›†ç¾¤æ­å»ºï¼Œå¦‚æœåœ¨å®é™…ç¯å¢ƒä¸­ä¸éœ€è¦æ”¹è„šæœ¬é…ç½®

```bash
# redis-start.sh å¯åŠ¨è„šæœ¬
#!bin/bash
redis-server redis6380.conf
redis-server redis6381.conf
redis-server redis6382.conf
echo complete start

chmod 777 redis-stop.sh # å¢åŠ æ‰§è¡Œæƒé™
```

```bash
# redis-stop.sh åœæ­¢è„šæœ¬
#!bin/bash
redis-cli -p 6380 shutdown
redis-cli -p 6381 shutdown
redis-cli -p 6382 shutdown
echo complete stop

chmod 777 redis-stop.sh # å¢åŠ æ‰§è¡Œæƒé™
```

## ä¹ã€Redis çš„å“¨å…µé›†ç¾¤æ¨¡å¼

ä¸»ä»å¤åˆ¶ç¼ºé™·æ˜¯ä¸»æœºæŒ‚äº†ï¼Œå¤„ç†æ–¹å¼æœ‰å†·å¤„ç†å°±æ˜¯æ‰‹åŠ¨å°†æŸä¸€ä¸ª slave æ‰§è¡Œ slaveof no one æ™‹å‡ä¸º masterï¼Œçƒ­å¤„ç†å°±æ˜¯å“¨å…µæœºåˆ¶

å…ˆå®‰è£… redis-sentinel

```bash
sudo apt-get install redis-sentinel
```

sentinel çš„é»˜è®¤é…ç½®åœ¨ /etc/redis/ ç›®å½•ä¸‹ï¼Œæ·»åŠ å…¶ä»– sentinel é…ç½®æ­å»ºå“¨å…µä¼ªé›†ç¾¤

è¦å…ˆå°† redis-sentinel.conf é…ç½®æ–‡ä»¶è¿›è¡Œæ³¨é‡Š

![image-20250112120456216](images/image-20250112120456216.png)

åœ¨ /etc/redis ç›®å½•ä¸‹åˆ›å»º sentinel26380.conf ï¼Œé…ç½®å¦‚ä¸‹

```bash
include sentinel.conf
pidfile /run/sentinel/redis-sentinel26380.pid
port 26380
sentinel monitor mymaster 192.168.1.201 6380 2

# logfile access26380.log
```

ç„¶åå‚è€ƒæ­¤é…ç½®ä¾æ¬¡åˆ›å»º sentinel26381.confã€sentinel26382.confï¼Œå¯ä»¥åœ¨ç»™é…ç½®æ·»åŠ æ‰§è¡Œæƒé™

```bash
sudo chmod 777 sentinel26380.conf sentinel26381.conf sentinel26382.conf # æ·»åŠ æ‰§è¡Œæƒé™
```

é…ç½® sentinel-start.sh  å¯åŠ¨è„šæœ¬

```bash
# sentinel-start.sh
#!bin/bash
redis-sentinel sentinel26380.conf
redis-sentinel sentinel26381.conf
redis-sentinel sentinel26382.conf
echo sentinel complete start

sudo chmod 777 sentinel-start.sh # å¢åŠ æ‰§è¡Œæƒé™
```

é…ç½® sentinel-stop.sh  åœæ­¢è„šæœ¬

```bash
# sentinel-stop.sh
#!bin/bash
redis-cli -p 26380 shutdown
redis-cli -p 26380 shutdown
redis-cli -p 26380 shutdown

sudo chmod 777 sentinel-stop.sh # å¢åŠ æ‰§è¡Œæƒé™
```

åœ¨é…ç½®ä¸»ä»å¤åˆ¶ä¹‹åï¼Œæ‰§è¡Œå¯åŠ¨ sentinel-start.sh è„šæœ¬

```bash
sh sentinel-start.sh
```

å¯ä»¥æ‰§è¡Œç›¸å…³å‘½ä»¤æŸ¥çœ‹ sentinel ä¿¡æ¯

```bash
redis-cli -p 26380 info sentinel
```

![image-20250112130030229](images/image-20250112130030229.png)

å½“ç«¯å£ä¸º 6380 çš„ master å®•æœºæ—¶ï¼Œä¼šå…ˆå®‰è£… slave èŠ‚ç‚¹çš„ä¼˜å…ˆçº§è¿›è¡Œé€‰ä¸¾ï¼Œslave æ¥å£ä¼šå‡çº§ä¸º master ï¼Œä½†æ˜¯ä½¿ç”¨ info replication å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ä¿¡æ¯æ—¶ï¼Œè¢«å‡çº§ä¸º master çš„ slave èŠ‚ç‚¹ï¼Œä½†æ˜¯ä¿¡æ¯ä¸Šè¿˜æ˜¯æ˜¾ç¤ºçš„ role:slaveï¼Œä¹Ÿä¼šå¤šå‡ºä¸€ä¸ªåˆ†çº§slave èŠ‚ç‚¹ï¼Œè¯¦ç»†å¦‚ä¸‹ï¼š

![image-20250112133506235](images/image-20250112133506235.png)





